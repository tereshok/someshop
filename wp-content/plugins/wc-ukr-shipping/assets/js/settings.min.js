!function(t){var s={};function e(n){if(s[n])return s[n].exports;var o=s[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}e.m=t,e.c=s,e.d=function(t,s,n){e.o(t,s)||Object.defineProperty(t,s,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,s){if(1&s&&(t=e(t)),8&s)return t;if(4&s&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&s&&"string"!=typeof t)for(var o in t)e.d(n,o,function(s){return t[s]}.bind(null,o));return n},e.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(s,"a",s),s},e.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},e.p="",e(e.s=0)}([function(t,s,e){"use strict";e.r(s);var n,o={init:function(t){this._$=t,this._successHandler=null,this._errorHandler=null,this._responseHandler=null},post:function(t,s){var e=this;return e._$.ajax({method:"POST",url:wc_ukr_shipping_globals.ajaxUrl,data:Object.assign({action:t,_token:wc_ukr_shipping_globals.nonce},s),dataType:"json",success:function(t){"function"==typeof e._successHandler&&e._successHandler(t)},error:function(t,s,n){"function"==typeof e._errorHandler&&e._errorHandler(t,s,n)},complete:function(){"function"==typeof e._responseHandler&&e._responseHandler()}}),this},success:function(t){return this._successHandler=t,this},error:function(t){return this._errorHandler=t,this},response:function(t){return this._responseHandler=t,this}},i={init:function(t){this._$=t},setLoadingState:function(){this._$("#wc-ukr-shipping-settings").addClass("wcus-state-loading")},unsetLoadingState:function(){this._$("#wc-ukr-shipping-settings").removeClass("wcus-state-loading")}},r={init:function(t){this.locked=!1,this.apiKey=t},lock:function(){this._locked=!0},unlock:function(){this._locked=!1},setApiKey:function(t){this.apiKey=t}},a={init:function(t){this._$=t,this.loaders=[],this.$logger=null,this.$btn=t(".wcus-settings__update-data"),this.btnHtml="",this.initEvents()},setNext:function(t){return this.loaders.push(t),this},log:function(t){this.$logger.html(this.$logger.html()+"<div>"+t+"</div>")},loadNext:function(){this.loaders.length||this.success();var t=this.loaders.shift();t&&t.call(this)},loadAreas:function(){var t=this;t.log("Начинаю загрузку географических областей..."),o.post("wc_ukr_shipping_load_areas",{_token:wc_ukr_shipping_globals.nonce}).success((function(s){s.success?(t.log("Загрузка географических областей успешно завершена!"),t.loadNext()):t.error(s.data)}))},loadCities:function(t){var s=this;void 0===t&&(t=1),1===t&&s.log("Начинаю загрузку городов..."),o.post("wc_ukr_shipping_load_cities",{_token:wc_ukr_shipping_globals.nonce,page:t}).success((function(e){e.success&&(!0===e.data.loaded?(s.log("Загрузка городов успешно завершена!"),s.loadNext()):s.loadCities(t+1))}))},loadWarehouses:function(t){var s=this;void 0===t&&(t=1),1===t&&s.log("Начинаю загрузку отделений..."),o.post("wc_ukr_shipping_load_warehouses",{_token:wc_ukr_shipping_globals.nonce,page:t}).success((function(e){e.success&&(!0===e.data.loaded?(s.log("Загрузка городов успешно завершена!"),s.loadNext()):s.loadWarehouses(t+1))}))},error:function(t){if(r.unlock(),this.$btn.html(this.btnHtml),this.$logger.removeClass("wcus-message--log"),this.$logger.addClass("wcus-message--error"),t.exception)this.$logger.html("\n        <div><strong>API service exception</strong></div>\n        <div>".concat(t.exception,"</div>\n      "));else{var s="";t.errors.forEach((function(t){s+="<div>".concat(t,"</div>")})),this.$logger.html("\n        <div><strong>API error</strong></div>\n        <div>".concat(s,"</div>\n      "))}},success:function(){r.unlock(),this.$btn.html(this.btnHtml),this.$logger.removeClass("wcus-message--log"),this.$logger.html("Данные успешно обновлены."),this.$logger.addClass("wcus-message--ok")},initEvents:function(){var t=this;t.$btn.on("click",(function(s){s.preventDefault(),r.locked||(r.lock(),t.btnHtml=t.$btn.html(),t.$btn.html('<span class="wcus-btn-loader"></span>'),t._$("#wcus-updating-data-state").html(""),t.$logger=t._$("<div/>"),t.$logger.addClass("wcus-message wcus-message--log"),t.$logger.appendTo("#wcus-updating-data-state"),t.loaders=[],t.setNext(t.loadAreas).setNext(t.loadCities).setNext(t.loadWarehouses),t.loadNext())}))}};n=jQuery,r.init(n("#wc_ukr_shipping_np_api_key").val()),o.init(n),i.init(n),a.init(n),n("#wc-ukr-shipping-settings-form").on("submit",(function(t){t.preventDefault(),r.locked||(r.lock(),i.setLoadingState(),o.post("wcus_save_options",{data:n(this).serialize()}).success((function(t){if(t.success)r.setApiKey(t.data.api_key),n("#wcus-settings-success-msg").html(t.data.message).addClass("active"),setTimeout((function(){n("#wcus-settings-success-msg").removeClass("active")}),2500);else{var s=t.errors;for(var e in s)s.hasOwnProperty(e)&&(n("#"+e).addClass("wcus-form-control--invalid"),n("#"+e).after('<div class="wcus-form-group__error">'+s[e]+"</div>"))}})).error((function(t,s,e){console.error("WCUS error: ".concat(t.status," ").concat(t.statusText))})).response((function(){r.unlock(),i.unsetLoadingState()})))})),n((function(){n("#wc_ukr_shipping_spinner_color").wpColorPicker()}))}]);